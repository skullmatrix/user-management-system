import{a as x,e as w,h as me}from"./chunk-I4CRZZPC.js";import{$ as Q,B as n,Ba as q,C as i,D as c,E as C,F as g,G as p,H as U,I as a,J as h,K as B,L as E,O as y,P as G,V as F,W as T,X as A,_ as N,fa as P,ga as f,ha as H,ia as z,ja as J,k as v,ka as K,la as W,m as $,ma as X,n as O,na as Y,o as V,oa as Z,p as b,pa as ee,q as S,qa as te,ra as ie,s as r,t as u,ta as ne,u as R,ua as re,v as D,w as d,wa as oe,y as o,ya as se,za as ae}from"./chunk-KIRRPNFL.js";var M=(()=>{class t{constructor(e){this.http=e}getAll(){return this.http.get(`${x.apiUrl}/requests`)}getById(e){return this.http.get(`${x.apiUrl}/requests/${e}`)}create(e){return this.http.post(`${x.apiUrl}/requests`,e)}update(e,l){return this.http.put(`${x.apiUrl}/requests/${e}`,l)}delete(e){return this.http.delete(`${x.apiUrl}/requests/${e}`)}static{this.\u0275fac=function(l){return new(l||t)(V(Q))}}static{this.\u0275prov=$({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var ve=(t,m,e)=>({"bg-warning":t,"bg-success":m,"bg-danger":e});function _e(t,m){t&1&&(n(0,"span",19),a(1,"(Admin User)"),i())}function ge(t,m){t&1&&(n(0,"span",20),a(1,"(Normal User)"),i())}function he(t,m){if(t&1&&(n(0,"div"),a(1),i()),t&2){let e=m.$implicit;r(),E(" ",e.name," (x",e.quantity,") ")}}function ye(t,m){t&1&&(n(0,"div"),a(1," - "),i())}function qe(t,m){t&1&&c(0,"span",21)}function xe(t,m){t&1&&(n(0,"span"),a(1,"Delete"),i())}function be(t,m){if(t&1){let e=C();n(0,"tr")(1,"td"),a(2),i(),n(3,"td"),a(4),d(5,_e,2,0,"span",12)(6,ge,2,0,"span",13),i(),n(7,"td"),d(8,he,2,2,"div",8)(9,ye,2,0,"div",9),i(),n(10,"td")(11,"span",14),a(12),i()(),n(13,"td")(14,"div",15)(15,"a",16),a(16,"Edit"),i(),n(17,"button",17),g("click",function(){let s=b(e).$implicit,_=p();return S(_.deleteRequest(s.id))}),d(18,qe,1,0,"span",18)(19,xe,2,0,"span",9),i()()()()}if(t&2){let e=m.$implicit;r(2),h(e.type),r(2),B("",e.employee==null||e.employee.user==null?null:e.employee.user.email," "),r(),o("ngIf",(e.employee==null||e.employee.user==null?null:e.employee.user.role)==="Admin"),r(),o("ngIf",(e.employee==null||e.employee.user==null?null:e.employee.user.role)==="User"),r(2),o("ngForOf",e.items),r(),o("ngIf",!e.items||e.items.length===0),r(2),o("ngClass",G(13,ve,e.status==="Pending",e.status==="Approved",e.status==="Rejected")),r(),h(e.status),r(3),U("routerLink","edit/",e.id,""),r(2),o("disabled",e.isDeleting),r(),o("ngIf",e.isDeleting),r(),o("ngIf",!e.isDeleting)}}function Se(t,m){t&1&&(n(0,"div",24),c(1,"span",25),i())}function Ce(t,m){t&1&&(n(0,"div"),a(1," No requests found "),i())}function Ie(t,m){if(t&1&&(n(0,"tr")(1,"td",22),d(2,Se,2,0,"div",23)(3,Ce,2,0,"div",9),i()()),t&2){let e=p();r(2),o("ngIf",e.loading),r(),o("ngIf",!e.loading)}}var j=(()=>{class t{constructor(e,l){this.requestService=e,this.alertService=l,this.requests=[],this.loading=!1}ngOnInit(){this.loading=!0,this.requestService.getAll().pipe(v()).subscribe({next:e=>{this.requests=e,this.loading=!1},error:e=>{this.alertService.error(e),this.loading=!1}})}deleteRequest(e){let l=this.requests.find(s=>s.id===e);l.isDeleting=!0,this.requestService.delete(e).pipe(v()).subscribe({next:()=>{this.requests=this.requests.filter(s=>s.id!==e),this.alertService.success("Request deleted successfully")},error:s=>{this.alertService.error(s),l.isDeleting=!1}})}static{this.\u0275fac=function(l){return new(l||t)(u(M),u(w))}}static{this.\u0275cmp=R({type:t,selectors:[["app-requests-list"]],decls:24,vars:2,consts:[[1,"card"],[1,"card-header"],[1,"card-body"],[1,"table-responsive"],[1,"table","table-striped"],[2,"width","15%"],[2,"width","25%"],[2,"width","20%"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"text-end","mt-3"],["routerLink","add",1,"btn","btn-primary"],["class","text-danger",4,"ngIf"],["class","text-primary",4,"ngIf"],[1,"badge",3,"ngClass"],[1,"btn-group"],[1,"btn","btn-primary",3,"routerLink"],[1,"btn","btn-danger",3,"click","disabled"],["class","spinner-border spinner-border-sm",4,"ngIf"],[1,"text-danger"],[1,"text-primary"],[1,"spinner-border","spinner-border-sm"],["colspan","5",1,"text-center"],["class","d-flex justify-content-center",4,"ngIf"],[1,"d-flex","justify-content-center"],[1,"spinner-border","spinner-border-lg"]],template:function(l,s){l&1&&(n(0,"div",0)(1,"h4",1),a(2,"REQUESTS"),i(),n(3,"div",2)(4,"div",3)(5,"table",4)(6,"thead")(7,"tr")(8,"th",5),a(9,"Type"),i(),n(10,"th",6),a(11,"Employee"),i(),n(12,"th",6),a(13,"Items"),i(),n(14,"th",5),a(15,"Status"),i(),n(16,"th",7),a(17,"Actions"),i()()(),n(18,"tbody"),d(19,be,20,17,"tr",8)(20,Ie,4,2,"tr",9),i()()(),n(21,"div",10)(22,"a",11),a(23,"Add Request"),i()()()()),l&2&&(r(19),o("ngForOf",s.requests),r(),o("ngIf",!s.requests||s.requests.length===0))},dependencies:[N,F,T,A,q,ae],encapsulation:2})}}return t})();var I=t=>({"is-invalid":t});function Re(t,m){if(t&1&&(n(0,"option",18),a(1),i()),t&2){let e=m.$implicit;o("value",e),r(),h(e)}}function Ee(t,m){t&1&&(n(0,"div"),a(1,"Type is required"),i())}function Fe(t,m){if(t&1&&(n(0,"div",19),d(1,Ee,2,0,"div",20),i()),t&2){let e=p();r(),o("ngIf",e.f.type.errors.required)}}function Te(t,m){if(t&1&&(n(0,"option",18),a(1),i()),t&2){let e=m.$implicit;o("value",e.id),r(),E(" ",e.user==null?null:e.user.email," (",e.id,") ")}}function Ae(t,m){t&1&&(n(0,"div"),a(1,"Employee is required"),i())}function Ne(t,m){if(t&1&&(n(0,"div",19),d(1,Ae,2,0,"div",20),i()),t&2){let e=p();r(),o("ngIf",e.f.employeeId.errors.required)}}function we(t,m){if(t&1&&(n(0,"option",18),a(1),i()),t&2){let e=m.$implicit;o("value",e),r(),h(e)}}function Me(t,m){t&1&&(n(0,"div"),a(1,"Status is required"),i())}function ke(t,m){if(t&1&&(n(0,"div",19),d(1,Me,2,0,"div",20),i()),t&2){let e=p(2);r(),o("ngIf",e.f.status.errors.required)}}function Le(t,m){if(t&1&&(n(0,"div",4)(1,"label",5),a(2,"Status"),i(),n(3,"div",6)(4,"select",21),d(5,we,2,2,"option",9),i(),d(6,ke,2,1,"div",10),i()()),t&2){let e=p();r(4),o("ngClass",y(3,I,e.submitted&&e.f.status.errors)),r(),o("ngForOf",e.statusOptions),r(),o("ngIf",e.submitted&&e.f.status.errors)}}function je(t,m){t&1&&(n(0,"div"),a(1,"Name is required"),i())}function $e(t,m){if(t&1&&(n(0,"div",19),d(1,je,2,0,"div",20),i()),t&2){let e=p().$implicit;r(),o("ngIf",e.get("name").errors.required)}}function Oe(t,m){t&1&&(n(0,"div"),a(1,"Quantity is required"),i())}function Ve(t,m){t&1&&(n(0,"div"),a(1,"Quantity must be at least 1"),i())}function De(t,m){if(t&1&&(n(0,"div",19),d(1,Oe,2,0,"div",20)(2,Ve,2,0,"div",20),i()),t&2){let e=p().$implicit;r(),o("ngIf",e.get("quantity").errors.required),r(),o("ngIf",e.get("quantity").errors.min)}}function Ue(t,m){if(t&1){let e=C();n(0,"tr",31)(1,"td"),c(2,"input",32),d(3,$e,2,1,"div",10),i(),n(4,"td"),c(5,"input",33),d(6,De,3,2,"div",10),i(),n(7,"td",34)(8,"button",35),g("click",function(){let s=b(e).index,_=p(2);return S(_.removeItem(s))}),a(9,"Remove"),i()()()}if(t&2){let e=m.$implicit,l=m.index,s=p(2);o("formGroupName",l),r(2),o("ngClass",y(5,I,s.submitted&&e.get("name").errors)),r(),o("ngIf",s.submitted&&e.get("name").errors),r(2),o("ngClass",y(7,I,s.submitted&&e.get("quantity").errors)),r(),o("ngIf",s.submitted&&e.get("quantity").errors)}}function Be(t,m){if(t&1){let e=C();n(0,"div",22)(1,"label",23),a(2,"Items"),i(),n(3,"div",24)(4,"table",25)(5,"thead")(6,"tr")(7,"th",26),a(8,"Name"),i(),n(9,"th",26),a(10,"Quantity"),i(),c(11,"th",27),i()(),n(12,"tbody",28),d(13,Ue,10,9,"tr",29),i()()(),n(14,"div",30)(15,"button",17),g("click",function(){b(e);let s=p();return S(s.addItem())}),a(16,"Add Item"),i()()()}if(t&2){let e=p();r(13),o("ngForOf",e.itemsArray.controls)}}function Ge(t,m){t&1&&c(0,"span",36)}var k=(()=>{class t{constructor(e,l,s,_,de,pe){this.formBuilder=e,this.route=l,this.router=s,this.requestService=_,this.employeeService=de,this.alertService=pe,this.loading=!1,this.submitted=!1,this.employees=[],this.requestTypes=["Equipment","Resources","Leave"],this.statusOptions=["Pending","Approved","Rejected"],this.itemRequiredTypes=["Equipment","Resources"]}ngOnInit(){this.id=this.route.snapshot.params.id,this.isAddMode=!this.id,this.employeeService.getAll().pipe(v()).subscribe({next:e=>this.employees=e,error:e=>this.alertService.error(e)}),this.form=this.formBuilder.group({type:["",f.required],employeeId:["",f.required],status:[{value:"Pending",disabled:this.isAddMode},f.required],items:this.formBuilder.array([])}),this.form.get("type")?.valueChanges.subscribe(e=>{this.itemRequiredTypes.includes(e)||this.itemsArray.clear()}),this.isAddMode||(this.loading=!0,this.requestService.getById(parseInt(this.id)).pipe(v()).subscribe({next:e=>{this.form.patchValue({type:e.type,employeeId:e.employeeId,status:e.status}),this.itemsArray.clear(),this.itemRequiredTypes.includes(e.type)&&e.items&&e.items.forEach(l=>{this.itemsArray.push(this.formBuilder.group({name:[l.name,f.required],quantity:[l.quantity,[f.required,f.min(1)]]}))}),this.loading=!1},error:e=>{this.alertService.error(e),this.loading=!1}}))}showItemsSection(){let e=this.form.get("type")?.value;return this.itemRequiredTypes.includes(e)}get f(){return this.form.controls}get itemsArray(){return this.form.get("items")}addItem(){let e=this.formBuilder.group({name:["",f.required],quantity:[1,[f.required,f.min(1)]]});this.itemsArray.push(e)}removeItem(e){this.itemsArray.removeAt(e)}onSubmit(){if(this.submitted=!0,this.alertService.clear(),this.form.invalid)return;let e=this.form.get("type")?.value;if(this.itemRequiredTypes.includes(e)&&this.itemsArray.length===0){this.alertService.error(`Please add at least one item to the ${e.toLowerCase()} request`);return}this.loading=!0,this.isAddMode?this.createRequest():this.updateRequest()}onCancel(){this.isAddMode?this.router.navigate(["../"],{relativeTo:this.route}):this.router.navigate(["../../"],{relativeTo:this.route})}createRequest(){this.requestService.create(this.form.getRawValue()).pipe(v()).subscribe({next:()=>{this.alertService.success("Request added successfully",{keepAfterRouteChange:!0}),this.router.navigate(["../"],{relativeTo:this.route})},error:e=>{this.alertService.error(e),this.loading=!1}})}updateRequest(){this.requestService.update(parseInt(this.id),this.form.getRawValue()).pipe(v()).subscribe({next:()=>{this.alertService.success("Request updated successfully",{keepAfterRouteChange:!0}),this.router.navigate(["../../"],{relativeTo:this.route})},error:e=>{this.alertService.error(e),this.loading=!1}})}static{this.\u0275fac=function(l){return new(l||t)(u(ne),u(oe),u(se),u(M),u(me),u(w))}}static{this.\u0275cmp=R({type:t,selectors:[["app-requests-form"]],decls:29,vars:16,consts:[[1,"card"],[1,"card-header"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"mb-3","row"],[1,"col-sm-2","col-form-label"],[1,"col-sm-10"],["formControlName","type",1,"form-select",3,"ngClass"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["formControlName","employeeId",1,"form-select",3,"ngClass"],["class","mb-3 row",4,"ngIf"],["class","mb-4",4,"ngIf"],[1,"d-flex","justify-content-center","mt-4"],[1,"btn","btn-primary","me-2",3,"disabled"],["class","spinner-border spinner-border-sm me-1",4,"ngIf"],["type","button",1,"btn","btn-secondary",3,"click"],[3,"value"],[1,"invalid-feedback"],[4,"ngIf"],["formControlName","status",1,"form-select",3,"ngClass"],[1,"mb-4"],[1,"col-form-label"],[1,"table-responsive"],[1,"table","table-borderless"],[2,"width","45%"],[2,"width","10%"],["formArrayName","items"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-start","mb-3"],[3,"formGroupName"],["type","text","formControlName","name",1,"form-control",3,"ngClass"],["type","number","formControlName","quantity",1,"form-control",3,"ngClass"],[1,"text-center"],["type","button",1,"btn","btn-danger",3,"click"],[1,"spinner-border","spinner-border-sm","me-1"]],template:function(l,s){l&1&&(n(0,"div",0)(1,"h4",1),a(2),i(),n(3,"div",2)(4,"form",3),g("ngSubmit",function(){return s.onSubmit()}),n(5,"div",4)(6,"label",5),a(7,"Type"),i(),n(8,"div",6)(9,"select",7),c(10,"option",8),d(11,Re,2,2,"option",9),i(),d(12,Fe,2,1,"div",10),i()(),n(13,"div",4)(14,"label",5),a(15,"Employee"),i(),n(16,"div",6)(17,"select",11),c(18,"option",8),d(19,Te,2,3,"option",9),i(),d(20,Ne,2,1,"div",10),i()(),d(21,Le,7,5,"div",12)(22,Be,17,1,"div",13),n(23,"div",14)(24,"button",15),d(25,Ge,1,0,"span",16),a(26," Save "),i(),n(27,"button",17),g("click",function(){return s.onCancel()}),a(28,"Cancel"),i()()()()()),l&2&&(r(2),h(s.isAddMode?"ADD REQUEST":"EDIT REQUEST"),r(2),o("formGroup",s.form),r(5),o("ngClass",y(12,I,s.submitted&&s.f.type.errors)),r(2),o("ngForOf",s.requestTypes),r(),o("ngIf",s.submitted&&s.f.type.errors),r(5),o("ngClass",y(14,I,s.submitted&&s.f.employeeId.errors)),r(2),o("ngForOf",s.employees),r(),o("ngIf",s.submitted&&s.f.employeeId.errors),r(),o("ngIf",!s.isAddMode),r(),o("ngIf",s.showItemsSection()),r(2),o("disabled",s.loading),r(),o("ngIf",s.loading))},dependencies:[N,F,T,A,re,J,te,ie,P,K,ee,H,z,W,Z,X,Y,q],encapsulation:2})}}return t})();var Qe=[{path:"",component:j},{path:"add",component:k},{path:"edit/:id",component:k}],at=(()=>{class t{static{this.\u0275fac=function(l){return new(l||t)}}static{this.\u0275mod=D({type:t})}static{this.\u0275inj=O({imports:[q.forChild(Qe),j,k]})}}return t})();export{at as RequestsModule};
