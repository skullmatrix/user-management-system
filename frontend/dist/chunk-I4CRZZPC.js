import{$ as u,a as p,b as g,c as j,d as x,f as $,g as U,h as T,j as C,l as b,m as a,o as s,ya as D}from"./chunk-KIRRPNFL.js";var i={production:!1,apiUrl:"https://planas-fullstack-user-management.onrender.com"};var n=`${i.apiUrl}/accounts`,B=(()=>{class r{constructor(t,e){this.router=t,this.http=e,this.accountSubject=new x(JSON.parse(localStorage.getItem("account")??"null")),this.account=this.accountSubject.asObservable()}get accountValue(){return this.accountSubject.value}login(t,e){return this.http.post(`${n}/authenticate`,{email:t,password:e},{withCredentials:!0}).pipe($(o=>(this.accountSubject.next(o),this.startRefreshTokenTimer(),o)))}logout(){this.http.post(`${n}/revoke-token`,{},{withCredentials:!0}).subscribe(),this.stopRefreshTokenTimer(),this.accountSubject.next(null),this.router.navigate(["/account/login"])}refreshToken(){return this.http.post(`${n}/refresh-token`,{},{withCredentials:!0}).pipe($(t=>(this.accountSubject.next(t),this.startRefreshTokenTimer(),t)))}register(t){return this.http.post(`${n}/register`,t)}verifyEmail(t){return this.http.post(`${n}/verify-email`,{token:t})}forgotPassword(t){return this.http.post(`${n}/forgot-password`,{email:t})}validateResetToken(t){return this.http.post(`${n}/validate-reset-token`,{token:t})}resetPassword(t,e,o){return this.http.post(`${n}/reset-password`,{token:t,password:e,confirmPassword:o})}getAll(){return this.http.get(n)}getById(t){return this.http.get(`${n}/${t}`)}create(t){return this.http.post(n,t)}update(t,e){return this.http.put(`${n}/${t}`,e).pipe($(o=>(o.id===this.accountValue.id&&(o=p(p({},this.accountValue),o),this.accountSubject.next(o)),o)))}delete(t){return this.http.delete(`${n}/${t}`).pipe(C(()=>{this.accountValue&&t===this.accountValue.id&&this.logout()}))}startRefreshTokenTimer(){if(this.accountValue&&this.accountValue.jwtToken){let t=JSON.parse(atob(this.accountValue.jwtToken.split(".")[1]));if(t&&t.exp){let o=new Date(t.exp*1e3).getTime()-Date.now()-60*1e3;this.refreshTokenTimeout=setTimeout(()=>this.refreshToken().subscribe(),o)}else console.error("Invalid JWT token or missing expiration time."),this.logout()}}stopRefreshTokenTimer(){clearTimeout(this.refreshTokenTimeout)}static{this.\u0275fac=function(e){return new(e||r)(s(D),s(u))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var H=function(r){return r.User="User",r.Admin="Admin",r}(H||{});var h=class{constructor(F){Object.assign(this,F)}},f=function(r){return r[r.Success=0]="Success",r[r.Error=1]="Error",r[r.Info=2]="Info",r[r.Warning=3]="Warning",r}(f||{});var rt=(()=>{class r{constructor(){this.subject=new j,this.defaultId="default-alert"}onAlert(t=this.defaultId){return this.subject.asObservable().pipe(T(e=>e&&e.id===t))}success(t,e){this.alert(new h(g(p({},e),{type:f.Success,message:t})))}error(t,e){this.alert(new h(g(p({},e),{type:f.Error,message:t})))}info(t,e){this.alert(new h(g(p({},e),{type:f.Info,message:t})))}warn(t,e){this.alert(new h(g(p({},e),{type:f.Warning,message:t})))}alert(t){t.id=t.id||this.defaultId,t.autoClose=t.autoClose===void 0?!0:t.autoClose,this.subject.next(t)}clear(t=this.defaultId){this.subject.next(new h({id:t}))}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var V=(()=>{class r{constructor(t){this.http=t}getByEmployeeId(t){return this.http.get(`${i.apiUrl}/workflows/employee/${t}`)}create(t){return this.http.post(`${i.apiUrl}/workflows`,t)}updateStatus(t,e){return this.http.put(`${i.apiUrl}/workflows/${t}/status`,{status:e})}static{this.\u0275fac=function(e){return new(e||r)(s(u))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var W=(()=>{class r{constructor(t){this.http=t}getAll(){return this.http.get(`${i.apiUrl}/departments`)}getById(t){return this.http.get(`${i.apiUrl}/departments/${t}`)}create(t){return this.http.post(`${i.apiUrl}/departments`,t)}update(t,e){return this.http.put(`${i.apiUrl}/departments/${t}`,e)}delete(t){return this.http.delete(`${i.apiUrl}/departments/${t}`)}static{this.\u0275fac=function(e){return new(e||r)(s(u))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var y=(()=>{class r{constructor(t,e){this.workflowService=t,this.accountService=e}trackDepartmentChange(t,e,o,c,l){let m=this.accountService.accountValue,d=m?m.email:"System",w=new Date().toLocaleString(),v=`Employee's department changed from ${c} (ID: ${e}) to ${l} (ID: ${o}) by ${d} on ${w}`,I={employeeId:t,type:"DepartmentChange",details:v};return this.workflowService.create(I)}trackRequestSubmission(t,e,o){let c=this.accountService.accountValue,l=c?c.email:"System",m=new Date().toLocaleString(),d=`New ${o} request (ID: ${e}) created by ${l} on ${m}`,w={employeeId:t,type:"RequestSubmission",details:d};return this.workflowService.create(w)}trackRequestStatusChange(t,e,o,c,l){let m=this.accountService.accountValue,d=m?m.email:"System",w=new Date().toLocaleString(),v=`${l} request (ID: ${e}) status changed from ${o} to ${c} by ${d} on ${w}`,I={employeeId:t,type:"RequestStatusChange",details:v};return this.workflowService.create(I)}static{this.\u0275fac=function(e){return new(e||r)(s(V),s(B))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var ut=(()=>{class r{constructor(t,e,o){this.http=t,this.workflowTrackerService=e,this.departmentService=o}getAll(){return this.http.get(`${i.apiUrl}/employees`)}getById(t){return this.http.get(`${i.apiUrl}/employees/${t}`)}create(t){return this.http.post(`${i.apiUrl}/employees`,t)}update(t,e){return this.getById(t).pipe(b(o=>o.departmentId!==e.departmentId?U({oldDept:this.departmentService.getById(o.departmentId),newDept:this.departmentService.getById(e.departmentId)}).pipe(b(c=>(this.workflowTrackerService.trackDepartmentChange(t,o.departmentId,e.departmentId,c.oldDept.name,c.newDept.name).subscribe({error:l=>console.error("Error tracking department change:",l)}),this.http.put(`${i.apiUrl}/employees/${t}`,e)))):this.http.put(`${i.apiUrl}/employees/${t}`,e)))}delete(t){return this.http.delete(`${i.apiUrl}/employees/${t}`)}static{this.\u0275fac=function(e){return new(e||r)(s(u),s(y),s(W))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{i as a,B as b,f as c,H as d,rt as e,V as f,W as g,ut as h};
